const t=({from:t,to:e})=>t.isSame(e,"day")?"day":e.day(0)&&t.isSame(e.subtract(6,"day"),"day")?"week":t.isSame(e,"month")&&1===t.date()&&e.date()===e.daysInMonth()?"month":t.isSame(e,"year")&&1===t.date()&&0===t.month()&&31===e.date()&&11===e.month()?"year":"custom";var e={computed:{canAccess(){return!(t=this).$permissions.hasOwnProperty("access")||!t.$permissions.access.hasOwnProperty("retour")||!1!==t.$permissions.access.retour;var t},canUpdate(){return this.$permissions.hasOwnProperty("site")&&this.$permissions.access.hasOwnProperty("update")?!1!==this.$permissions.site.update:this.canAccess}}};function s(t,e,s,r,o,i,n,a){var l,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=s,u._compiled=!0),r&&(u.functional=!0),i&&(u._scopeId="data-v-"+i),n?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},u._ssrRegister=l):o&&(l=a?function(){o.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(t,e){return l.call(e),c(t,e)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:u}}const r={};var o=s({props:{segments:Array},computed:{gradient(){let t="",e=0;const s=this.total/180;for(let r=0;r<this.segments.length;r++)t+=`${this.segments[r].color} ${e}deg,`,e+=this.segments[r].data/s,t+=`${this.segments[r].color} ${e}deg,`;return t+="transparent 180deg",t},total(){return this.segments.reduce(((t,e)=>t+e.data),0)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("figure",{staticClass:"chart-pie"},[s("div",{staticClass:"graph",style:"--gradient: "+t.gradient}),t._v(" "),s("figcaption",[s("ul",t._l(t.segments,(function(e){return s("li",{key:e.label},[s("k-icon",{style:"--color:"+e.color,attrs:{type:"circle"}}),t._v("\n        "+t._s(e.data)+" "+t._s(e.label)+"\n      ")],1)})),0)])])}),[],!1,(function(t){for(let e in r)this[e]=r[e]}),null,null,null).exports;const i={};var n=s({props:{segments:Array},computed:{axisY(){const t=this.max/5;return[1,2,3,4,5].map((e=>{let s=e*t;return s>=1e3&&(s=Math.floor(s/100)/10+"k"),s}))},days(){const t=this.$store.state.retour.view,e=this.$library.dayjs(t.from);return this.$library.dayjs(t.to).diff(e,"day")},format(){return"day"===this.unit||0===this.days?"HH":"week"===this.unit?"ddd":"month"===this.unit?"D":"year"===this.unit?"MMM":this.days>50?"MMM YYYY":"D MMM"},unit(){return this.$store.getters["retour/unit"]},subunit(){switch(this.unit){case"day":return"hour";case"year":return"month";default:return"day"}},max(){let t=Math.max(...this.segments.map((t=>t.areas.reduce(((t,e)=>t+e.data),0))));if(t>0){const e=t.toString().length,s=Math.pow(10,e)/4;return Math.ceil(t/s)*s}return 5}},methods:{bounds(t,e){const s=t.areas.slice(0,e).reduce(((t,e)=>t+e.data),0);return{path:s+t.areas[e].data,mask:s}},clip(t,e){let s=this.bounds(this.segments[t],e),r={path:0,mask:0};return this.segments[t+1]&&(r=this.bounds(this.segments[t+1],e)),`--p0: ${s.path/this.max}; --p1: ${r.path/this.max}; --m0: ${s.mask/this.max}; --m1: ${r.mask/this.max};`},color(t,e){const s=this.segments[t+1];if(s){const t=this.$library.dayjs(s.label),e=this.$library.dayjs();if(t.isAfter(e,"day"))return"transparent"}return e.color},isCurrent(t){const e=this.$library.dayjs();return this.$library.dayjs(t.label).isSame(e,this.subunit)},isFirstOfMonth(t){return 1===this.$library.dayjs(t.label).date()},label(t){return this.$library.dayjs(t.label).format(this.format)},onZoom(t){const e=this.$library.dayjs(t.label);this.$store.dispatch("retour/view",{from:e.startOf(this.subunit),to:e.endOf(this.subunit)})}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",{staticClass:"chart-areas"},[s("thead",[s("tr",t._l(t.axisY,(function(e){return s("th",{key:e},[t._v(t._s(e))])})),0)]),t._v(" "),s("tbody",t._l(t.segments,(function(e,r){return s("tr",{key:r,on:{dblclick:function(s){return t.onZoom(e)}}},t._l(e.areas,(function(e,o){return s("td",{key:t.segmentInde+"_"+o,style:"--color: "+t.color(r,e)+"; "+t.clip(r,o)})})),0)})),0),t._v(" "),s("tfoot",{attrs:{"data-less":t.days>31&&t.days<=50,"data-month":t.days>50}},t._l(t.segments,(function(e){return s("tr",{key:e.label,attrs:{"data-current":t.isCurrent(e),"data-first-of-month":t.isFirstOfMonth(e)},on:{dblclick:function(s){return t.onZoom(e)}}},[s("td",[t._v(t._s(t.label(e)))])])})),0)])}),[],!1,(function(t){for(let e in i)this[e]=i[e]}),null,null,null).exports;const a={};var l=s({components:{Areas:n,Pie:o},computed:{data(){return this.$store.state.retour.data.stats},areas(){return this.data.map((t=>({label:t.date,areas:[{data:t.redirected,color:"var(--color-focus)"},{data:t.resolved,color:"var(--color-border)"},{data:t.failed,color:"var(--color-negative)"}]})))},pie(){return[{data:this.data.reduce(((t,e)=>t+e.redirected),0),color:"var(--color-focus)",label:this.$t("retour.stats.redirected")},{data:this.data.reduce(((t,e)=>t+e.resolved),0),color:"var(--color-border)",label:this.$t("retour.stats.resolved")},{data:this.data.reduce(((t,e)=>t+e.failed),0),color:"var(--color-negative)",label:this.$t("retour.stats.failed")}]}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-view",{staticClass:"stats"},[s("pie",{attrs:{segments:t.pie}}),t._v(" "),s("areas",{attrs:{segments:t.areas}})],1)}),[],!1,(function(t){for(let e in a)this[e]=a[e]}),null,null,null).exports;const u={};var c=s({computed:{current(){const t=this.$store.getters["retour/unit"];return"custom"===t&&!0===this.$store.getters["retour/isAll"]?"all":t},units:()=>["all","year","month","week","day"],hasPrev(){return this.$store.getters["retour/hasPrev"]},hasNext(){return this.$store.getters["retour/hasNext"]}},methods:{set(t){const e={from:this.$library.dayjs().startOf("day"),to:this.$library.dayjs().endOf("day")};switch(t){case"all":const t=this.$store.state.retour.meta;e.from=this.$library.dayjs(t.first).startOf("day"),e.to=this.$library.dayjs(t.last).endOf("day");break;case"year":e.from=e.from.startOf("year"),e.to=e.to.endOf("year");break;case"month":e.from=e.from.startOf("month"),e.to=e.to.endOf("month");break;case"week":0===e.from.day()?e.from=e.from.subtract(6,"day"):(e.from=e.from.subtract(e.from.day()-1,"day"),e.to=e.to.add(7-e.to.day(),"day"))}return this.$store.dispatch("retour/view",e)},onNavigate(t){let e=this.current,s=1;"week"===e&&(s=7,e="day");const r=this.$store.state.retour.view;r.from=r.from[t](s,e).startOf(e),r.to=r.to[t](s,e).endOf(e),this.$store.dispatch("retour/view",r)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-button-group",{staticClass:"prevnext"},[s("k-button",{attrs:{icon:"angle-left",disabled:!t.hasPrev},on:{click:function(e){return t.onNavigate("subtract")}}}),t._v(" "),t._l(t.units,(function(e){return s("k-button",{key:e,attrs:{current:e===t.current},on:{click:function(s){return t.set(e)}}},[t._v("\n    "+t._s(t.$t("retour.stats.mode."+e))+"\n  ")])})),t._v(" "),s("k-button",{attrs:{icon:"angle-right",disabled:!t.hasNext},on:{click:function(e){return t.onNavigate("add")}}})],2)}),[],!1,(function(t){for(let e in u)this[e]=u[e]}),null,null,null).exports;const d={};var h=s({computed:{label(){const t=this.$store.getters["retour/unit"],e=this.$store.state.retour.view.from,s=this.$store.state.retour.view.to;return"day"===t?`${e.format("D")} ${this.month(e)} ${e.format("YYYY")}`:"month"===t?`${this.month(e)} ${e.format("YYYY")}`:"year"===t?`${e.format("YYYY")}`:e.isSame(s,"month")?`${e.format("D")} - ${s.format("D")} ${this.month(s)} ${s.format("YYYY")}`:e.isSame(s,"year")?`${e.format("D")} ${this.month(e)} - ${s.format("D")} ${this.month(s)} ${s.format("YYYY")}`:`${e.format("D")} ${this.month(e)} ${e.format("YYYY")} - ${s.format("D")} ${this.month(s)} ${s.format("YYYY")}`},value(){return Object.values(this.$store.state.retour.view).map((t=>t.format("YYYY-MM-DD HH:mm:ss")))}},methods:{month(t){return t=t.format("MMMM"),t=this.$helper.string.lcfirst(t),this.$t("months."+t)},onInput(t){2===t.length&&(this.$store.dispatch("retour/view",{from:this.$library.dayjs(t[0]),to:this.$library.dayjs(t[1])}),this.$refs.calendar.close())}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-dropdown",{staticClass:"dates"},[s("k-button-group",[s("k-button",{attrs:{icon:"calendar"},on:{click:function(e){return t.$refs.calendar.open()}}},[t._v("\n      "+t._s(t.label)+"\n    ")]),t._v(" "),s("k-dropdown-content",{ref:"calendar"},[s("k-calendar",{attrs:{multiple:!0,value:t.value},on:{input:t.onInput}})],1)],1)],1)}),[],!1,(function(t){for(let e in d)this[e]=d[e]}),null,null,null).exports;const p={};var m=s({components:{Dates:h,PrevNext:c},props:{tab:String,tabs:Array}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("header",{staticClass:"k-header"},[s("k-bar",{staticClass:"k-header-buttons",scopedSlots:t._u([{key:"left",fn:function(){return[s("dates")]},proxy:!0},{key:"right",fn:function(){return[s("prev-next")]},proxy:!0}])}),t._v(" "),s("k-tabs",{attrs:{tab:t.tab,tabs:t.tabs}})],1)])}),[],!1,(function(t){for(let e in p)this[e]=p[e]}),null,null,null).exports;const f={props:{align:{type:String,default:"right"},icon:{type:String,default:"dots"},options:{type:[Array,Function],default:()=>[]},text:{type:[Boolean,String],default:!1},theme:{type:String,default:"dark"}},computed:{label(){return!0!==this.text?this.text:this.options[0].text},single(){return Array.isArray(this.options)&&1===this.options.length}},methods:{onOption(t,e,s){this.$emit("option",t,e,s)}}},v={};var $=s(f,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.single&&t.options[0]?s("k-button",{staticClass:"k-options-dropdown-toggle",attrs:{icon:t.options[0].icon,theme:t.options[0].theme,tooltip:t.options[0].text,disabled:t.options[0].disabled},on:{click:function(e){return t.onOption(t.options[0].option||t.options[0].click,t.options[0],0)}}},[t.label?[t._v("\n    "+t._s(t.label)+"\n  ")]:t._e()],2):t.options.length?s("k-dropdown",{staticClass:"k-options-dropdown"},[s("k-button",{staticClass:"k-options-dropdown-toggle",attrs:{icon:t.icon||"dots",tooltip:t.$t("options")},on:{click:function(e){return t.$refs.options.toggle()}}},[t.text&&!0!==t.text?[t._v("\n      "+t._s(t.text)+"\n    ")]:t._e()],2),t._v(" "),s("k-dropdown-content",{ref:"options",staticClass:"k-options-dropdown-content",attrs:{align:t.align,options:t.options,theme:t.theme},on:{option:t.onOption,action:t.onOption}})],1):t._e()}),[],!1,(function(t){for(let e in v)this[e]=v[e]}),null,null,null).exports;const b={};var y=s({props:{row:Object},computed:{title(){return this.$t("retour.hits.last")+": "+this.row.last}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"k-table-count-cell",attrs:{title:t.title}},[t.row.hits>0?[t._v("\n    "+t._s(t.row.hits)+"\n    "),s("k-icon",{attrs:{title:t.title,type:"clock"}})]:s("p",[t._v("–")])],2)}),[],!1,(function(t){for(let e in b)this[e]=b[e]}),null,null,null).exports;const _={};var g=s({props:{value:String,column:Object},computed:{isExternal(){return this.value&&this.value.startsWith("http")},link(){return this.isExternal?this.value:window.panel.site+"/"+this.value}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"k-table-link-cell",attrs:{title:t.column.label+": "+t.value}},[t.value&&"-"!=t.value?s("k-button",{attrs:{link:t.link,icon:"url",target:"_blank"},nativeOn:{click:function(t){t.stopPropagation()}}}):t._e(),t._v("\n  "+t._s(t.value)+"\n")],1)}),[],!1,(function(t){for(let e in _)this[e]=_[e]}),null,null,null).exports;const k={};var w=s({props:{value:String,column:Object}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"k-table-priority-cell"},[t.value?s("k-icon",{attrs:{type:"bolt",title:t.column.label}}):s("p",[t._v("–")])],1)}),[],!1,(function(t){for(let e in k)this[e]=k[e]}),null,null,null).exports,x={computed:{color(){return this.value?parseInt(this.value)>=400?"var(--color-negative-light)":parseInt(this.value)>=300?"var(--color-positive-light)":"var(--color-focus-light)":"var(--color-border)"}}};const C={};const O={components:{"k-options-dropdown":$,"k-table-count-cell":y,"k-table-link-cell":g,"k-table-priority-cell":w,"k-table-status-cell":s({mixins:[x],props:{value:String,row:Object,column:Object}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"k-table-status-cell",attrs:{title:t.column.label+": "+(t.value||"-")}},[s("k-icon",{style:"color: "+t.color,attrs:{type:"circle"}}),t._v(" "),t.value?s("code",[t._v(t._s(t.value))]):s("span",[t._v(" –")])],1)}),[],!1,(function(t){for(let e in C)this[e]=C[e]}),null,null,null).exports},props:{columns:Object,index:{type:Number,default:1},rows:Array,options:[Array,Function],sortable:Boolean},data(){return{values:this.rows}},computed:{dragOptions(){return{disabled:!this.sortable,fallbackClass:"k-table-row-fallback",ghostClass:"k-table-row-ghost"}}},watch:{rows(){this.values=this.rows}},methods:{isComponent(t){return void 0!==this.$options.components[t]},indexOf(t){return this.index+t},onCell(t){this.$emit("cell",t)},onCellUpdate({columnIndex:t,rowIndex:e,value:s}){this.values[e][t]=s,this.$emit("input",this.values)},onHeader(t){this.$emit("header",t)},onOption(t,e,s){this.$emit("option",t,e,s)},onSort(){this.$emit("input",this.values),this.$emit("sort",this.values)},width(t){if(!t)return"auto";const e=t.toString().split("/");if(2!==e.length)return"auto";const s=Number(e[0]),r=Number(e[1]);return parseFloat(100/r*s,2).toFixed(2)+"%"}}},S={};var Y=s(O,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",t._g({staticClass:"k-table",attrs:{"data-sortable":t.sortable}},t.$listeners),[s("thead",[s("tr",[s("th",{staticClass:"k-table-index-column"},[t._v("\n        #\n      ")]),t._v(" "),t._l(t.columns,(function(e,r){return s("th",{key:r+"-header",staticClass:"k-table-column",style:"width:"+t.width(e.width),on:{click:function(s){return t.onHeader({label:e.label||r,column:e,columnIndex:r})}}},[t._t("header",[s("p",{staticClass:"k-table-header-label"},[t._v("\n            "+t._s(e.label||r)+"\n          ")])],null,{column:e,columnIndex:r,label:e.label||r})],2)})),t._v(" "),t.options?s("th",{staticClass:"k-table-options-column"},[t._t("button")],2):t._e()],2)]),t._v(" "),s("k-draggable",{attrs:{list:t.values,options:t.dragOptions,handle:!0,element:"tbody"},on:{end:t.onSort}},t._l(t.values,(function(e,r){return s("tr",{key:r},[s("td",{staticClass:"k-table-index-column"},[t.sortable?s("k-sort-handle",{staticClass:"k-table-sort-handle"}):t._e(),t._v(" "),s("span",{staticClass:"k-table-index"},[t._v(t._s(t.indexOf(r)))])],1),t._v(" "),t._l(t.columns,(function(o,i){return s("td",{key:r+"-"+i,staticClass:"k-table-column",style:"width:"+t.width(o.width),attrs:{"data-align":o.align,title:o.label},on:{click:function(s){return t.onCell({value:e[i],row:e,rowIndex:r,column:o,columnIndex:i})}}},[t._t("cell",[t.isComponent("k-table-"+(o.type||"text")+"-cell")?s("k-table-"+(o.type||"text")+"-cell",{tag:"component",attrs:{column:o,row:e,value:e[i]},on:{input:function(s){return t.onCellUpdate({value:s,row:e,rowIndex:r,column:o,columnIndex:i})}}}):s("p",{staticClass:"k-table-cell-value"},[t._v("\n            "+t._s(o.before)+" "+t._s(e[i]||"")+" "+t._s(o.after)+"\n          ")])],null,{column:o,columnIndex:i,row:e,rowIndex:r,value:e[i]})],2)})),t._v(" "),t.options?s("td",{staticClass:"k-table-options-column"},[s("k-options-dropdown",{attrs:{options:t.options},on:{option:function(s){return t.onOption(s,e,r)}}})],1):t._e()],2)})),0)],1)}),[],!1,(function(t){for(let e in S)this[e]=S[e]}),null,null,null).exports;const E={};var j=s({components:{"k-table":Y},props:{type:String,columns:Object,options:Array,rows:{type:Array,default:()=>[]},empty:String},data(){return{page:1,filter:null,storedLimit:sessionStorage.getItem("retour$"+this.type+"$limit")||10}},computed:{filteredRows(){if(!this.filter)return this.rows;const t=Object.keys(this.columns).filter((t=>!0===this.columns[t].filter));return this.rows.filter((e=>{let s=!1;return t.forEach((t=>{e[t]&&!0===e[t].includes(this.filter)&&(s=!0)})),!0===s}))},paginatedRows(){return this.limit&&"all"!==this.limit?this.filteredRows.slice(this.limit*(this.page-1),this.limit*this.page):this.filteredRows},limit(){return"all"===this.storedLimit?this.rows.length:parseInt(this.storedLimit)}},watch:{filteredRows(){this.page=1}},methods:{onLimit(t){this.page=1,this.storedLimit=t,sessionStorage.setItem("retour$"+this.type+"$limit",t)},onOption(t,e,s){this.$emit("option",t,e,s)},onPaginate(t){this.page=t.page}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list",attrs:{"data-loading":t.$store.state.isLoading}},[s("header",[s("div",{staticClass:"filter"},[s("label",{attrs:{for:"filter"}},[s("k-icon",{attrs:{type:"search"}})],1),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.filter,expression:"filter"}],attrs:{"data-empty":!t.filter,placeholder:t.$t("retour.table.filter"),id:"filter"},domProps:{value:t.filter},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;e.stopPropagation(),t.filter=null,e.target.blur()},input:function(e){e.target.composing||(t.filter=e.target.value)}}})]),t._v(" "),t._t("button")],2),t._v(" "),t.rows.length?s("k-table",{attrs:{columns:t.columns,index:t.limit*(t.page-1)+1,options:t.options,rows:t.paginatedRows},on:{cell:function(e){return t.$emit("cell",e)},header:function(e){return t.$emit("header",e)},input:function(e){return t.$emit("input",e)},option:t.onOption}}):s("k-empty",{attrs:{layout:"cards"}},[t._v("\n    "+t._s(t.empty)+"\n  ")]),t._v(" "),s("footer",[s("div",{staticClass:"limit"},[s("select",{domProps:{value:t.storedLimit},on:{input:function(e){return t.onLimit(e.target.value)}}},[s("option",{domProps:{value:10}},[t._v("10")]),t._v(" "),s("option",{domProps:{value:25}},[t._v("25")]),t._v(" "),s("option",{domProps:{value:50}},[t._v("50")]),t._v(" "),s("option",{attrs:{value:"all"}},[t._v(t._s(t.$t("retour.table.perPage.all")))])]),t._v(" \n      "+t._s(t.$t("retour.table.perPage.after"))+"\n    ")]),t._v(" "),s("k-pagination",{attrs:{details:!0,limit:t.limit,page:t.page,total:t.rows.length},on:{paginate:t.onPaginate}}),t._v(" "),s("div")],1),t._v(" "),t._t("dialogs")],2)}),[],!1,(function(t){for(let e in E)this[e]=E[e]}),null,null,null).exports;const I={};var M=s({mixins:[e],components:{List:j},data:()=>({row:null}),computed:{columns(){return{path:{label:this.$t("retour.failures.path"),type:"link",filter:!0,width:"1/3"},referrer:{label:this.$t("retour.failures.referrer"),type:"link",filter:!0,width:"1/3"},hits:{label:this.$t("retour.hits"),type:"count",width:"1/12",align:"right"}}},options(){return!1!==this.canUpdate&&[{text:this.$t("retour.failures.resolve"),icon:"add",click:"resolve"},{text:this.$t("remove"),icon:"trash",click:"remove"}]},rows(){return Object.values(this.$store.state.retour.data.fails)}},methods:{async flush(){try{await this.$api.post("retour/log/flush"),this.$refs.flush.close(),await this.$store.dispatch("retour/data"),this.$store.dispatch("notification/success")}catch(t){this.$store.dispatch("notification/error",t)}},async onOption(t,e){switch(t){case"remove":this.row=e,this.$refs.remove.open();break;case"resolve":await this.$router.push("#routes"),this.$events.$emit("retour.resolve",{from:e.path})}},async remove(){await this.$api.delete("retour/fails",{path:this.row.path,referrer:this.row.referrer}),this.$refs.remove.close(),await this.$store.dispatch("retour/data"),this.$store.dispatch("notification/success"),this.row=null}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("list",{attrs:{empty:t.$t("retour.failures.empty"),columns:t.columns,rows:t.rows,options:t.options,type:"failures"},on:{option:t.onOption},scopedSlots:t._u([t.canUpdate?{key:"button",fn:function(){return[s("k-button",{attrs:{icon:"trash"},on:{click:function(e){return t.$refs.flush.open()}}},[t._v("\n      "+t._s(t.$t("retour.failures.clear"))+"\n    ")])]},proxy:!0}:null,{key:"dialogs",fn:function(){return[s("k-remove-dialog",{ref:"remove",attrs:{"submit-button":t.$t("delete")},on:{submit:t.remove}},[s("k-text",[t._v(t._s(t.$t("field.structure.delete.confirm")))])],1),t._v(" "),s("k-remove-dialog",{ref:"flush",attrs:{"submit-button":t.$t("retour.failures.clear")},on:{submit:t.flush}},[s("k-text",[t._v(t._s(t.$t("retour.failures.clear.confirm")))])],1)]},proxy:!0}],null,!0)})}),[],!1,(function(t){for(let e in I)this[e]=I[e]}),null,null,null).exports;const A={};var L=s({mixins:[e],components:{List:j},data:()=>({row:{},rowIndex:null,completion:null}),computed:{columns(){let t={from:{label:this.$t("retour.routes.from"),type:"link",filter:!0,width:"7/20"},to:{label:this.$t("retour.routes.to"),type:"link",filter:!0,width:"7/20"},status:{label:this.$t("retour.routes.status"),type:"status",width:"1/10"},priority:{label:this.$t("retour.routes.priority.abbr"),type:"priority",width:"1/20"}};return this.hasLog&&(t.hits={label:this.$t("retour.hits"),width:"1/10",type:"count"}),t},fields(){const t=window.panel.site.replace(/^(http\:\/\/|https\:\/\/)/,"").replace(/^(www\.)/,"")+"/",e=Object.keys(this.headers).map((t=>({text:t.substr(1)+" - "+this.headers[t],value:t.substr(1)})));return{from:{label:this.$t("retour.routes.from"),type:"text",before:t,help:this.$t("retour.routes.from.help",{docs:"https://distantnative.com/retour/docs"}),counter:!1,required:!0},to:{label:this.$t("retour.routes.to"),type:"rt-destination",help:this.$t("retour.routes.to.help"),counter:!1},status:{label:this.$t("retour.routes.status"),type:"rt-status",options:e,help:this.$t("retour.routes.status.help",{docs:"https://distantnative.com/retour/docs"}),width:"1/2"},priority:{type:"toggle",label:this.$t("retour.routes.priority"),icon:"bolt",help:this.$t("retour.routes.priority.help"),width:"1/2"},comment:{type:"textarea",label:this.$t("retour.routes.comment"),buttons:!1,help:this.$t("retour.routes.comment.help")}}},hasLog(){return!1!==this.$store.state.retour.meta.hasLog},headers(){return this.$store.state.retour.meta.headers},options(){if(!1!==this.canUpdate)return[{text:this.$t("edit"),icon:"edit",click:"edit"},{text:this.$t("remove"),icon:"trash",click:"remove"}]},rows(){return Object.values(this.$store.state.retour.data.redirects)}},created(){this.$events.$on("retour.resolve",this.resolve)},destroyed(){this.$events.$off("retour.resolve",this.resolve)},methods:{onCell({row:t,rowIndex:e,columnIndex:s}){!1!==this.canUpdate&&(this.onOption("edit",t,e),setTimeout((()=>{this.$refs.entry.$refs.form.focus(s)}),25))},onClose(){this.row={},this.rowIndex=null,this.completion=null},onOption(t,e={},s=null){switch(t){case"add":case"edit":this.row=this.$helper.clone(e),this.rowIndex=s,this.$refs.entry.open();break;case"remove":this.rowIndex=s,this.$refs.remove.open()}},async onRemove(){this.$refs.remove.close();try{await this.$api.delete("retour/redirects/"+this.rowIndex),await this.$store.dispatch("retour/data"),this.$store.dispatch("notification/success",":)")}catch(t){this.$store.dispatch("notification/error",t)}},async onResolve(t){try{await this.$api.post("retour/log/resolve",{path:t.from}),await this.$store.dispatch("retour/data")}catch(e){this.$store.dispatch("notification/error",e.message)}},async onSave(){if(Object.values(this.$refs.entry.$refs.form.$refs.fields.errors).filter((t=>t.$invalid)).length>0)return this.$refs.entry.error(this.$t("field.required"));this.$refs.entry.close();try{null===this.rowIndex?await this.$api.post("retour/redirects",this.row):await this.$api.patch("retour/redirects/"+this.rowIndex,this.row),this.completion&&await this.completion(this.row),this.$store.dispatch("notification/success",":)")}catch(t){this.$store.dispatch("notification/error",t.message)}finally{await this.$store.dispatch("retour/data"),this.onClose()}},async resolve(t){this.completion=this.onResolve,this.onOption("add",t)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("list",{attrs:{columns:t.columns,rows:t.rows,options:t.options,empty:t.$t("retour.routes.empty"),type:"routes"},on:{cell:t.onCell,option:t.onOption},scopedSlots:t._u([t.canUpdate?{key:"button",fn:function(){return[s("k-button",{attrs:{icon:"add"},on:{click:function(e){return t.onOption("add")}}},[t._v("\n      "+t._s(t.$t("add"))+"\n    ")])]},proxy:!0}:null,{key:"dialogs",fn:function(){return[s("k-form-dialog",{ref:"entry",attrs:{fields:t.fields,novalidate:!1,size:"huge"},on:{cancel:t.onClose,submit:t.onSave},model:{value:t.row,callback:function(e){t.row=e},expression:"row"}}),t._v(" "),s("k-remove-dialog",{ref:"remove",attrs:{"submit-button":t.$t("delete")},on:{submit:t.onRemove}},[s("k-text",[t._v(t._s(t.$t("field.structure.delete.confirm")))])],1)]},proxy:!0}],null,!0)})}),[],!1,(function(t){for(let e in A)this[e]=A[e]}),null,null,null).exports;const P={};var D=s({computed:{data(){return this.$store.state.retour.data},fails(){return this.reduce(this.data.fails)},redirects(){return this.reduce(this.data.redirects)}},methods:{reduce:t=>t.reduce(((t,e)=>t+parseInt(e.hits||0)),0)}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"rt-settings-tab"},[s("header",[s("h3",[s("k-icon",{attrs:{type:"road-sign"}}),t._v(" Retour for Kirby\n    ")],1)]),t._v(" "),s("ul",{staticClass:"k-system-info-box"},[s("li",[s("dl",[s("dt",[t._v("\n          "+t._s(t.$t("retour.system.redirects"))+"\n        ")]),t._v(" "),s("dd",[t._v(t._s(t.redirects))])])]),t._v(" "),s("li",[s("dl",[s("dt",[t._v("\n          "+t._s(t.$t("retour.system.failures"))+"\n        ")]),t._v(" "),s("dd",[t._v(t._s(t.fails))])])]),t._v(" "),s("li",[s("dl",[s("dt",[t._v("\n          "+t._s(t.$t("retour.system.deleteAfter"))+"\n        ")]),t._v(" "),s("dd",[t._v("\n          "+t._s(t.$t("retour.system.deleteAfter.months",{count:t.$store.state.retour.meta.deleteAfter||"–"}))+"\n        ")])])]),t._v(" "),s("li",[s("dl",[s("dt",[t._v("\n          "+t._s(t.$t("retour.system.support"))+"\n        ")]),t._v(" "),s("dd",[s("k-button",{attrs:{link:"https://paypal.me/distantnative",target:"_blank",theme:"positive"}},[t._v("\n            💛 "+t._s(t.$t("retour.system.support.donate"))+"\n          ")])],1)])])]),t._v(" "),s("footer",{staticClass:"mt-2"},[s("k-text",{attrs:{theme:"help"},domProps:{innerHTML:t._s(t.$t("retour.system.docs",{docs:"https://distantnative.com/retour/docs"}))}})],1)])}),[],!1,(function(t){for(let e in P)this[e]=P[e]}),null,null,null).exports;const T={};var R=s({components:{Navigation:m,Fails:M,Routes:L,System:D},computed:{hasLog(){return!1!==this.$store.state.retour.meta.hasLog},tab(){return this.$route.hash.slice(1)||"routes"},tabs(){let t=[];const e=this.$store.state.retour,s=e.data.redirects.length;if(t.push({name:"routes",label:this.$t("retour.routes"),icon:"undo",badge:s||!1}),this.hasLog){let s=e.data.fails.length;s>=1e3&&(s=Math.floor(s/100)/10+"k"),t.push({name:"fails",label:this.$t("retour.failures"),icon:"alert",badge:s||!1}),t.push({name:"system",label:this.$t("retour.system"),icon:"box",badge:!1})}return t}},watch:{tab:{handler(){const t=this.tabs.filter((t=>t.name===this.tab))[0];setTimeout((()=>{this.$store.dispatch("breadcrumb",[{label:t.label,link:"/plugins/retour#"+t.name}])}),10)},immediate:!0}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-view",{staticClass:"tabs"},[t.hasLog?s("navigation",{attrs:{tab:t.tab,tabs:t.tabs}}):t._e(),t._v(" "),s(this.tab,{tag:"component",staticClass:"tab"})],1)}),[],!1,(function(t){for(let e in T)this[e]=T[e]}),null,null,null).exports;const N={};var U=s({mixins:[e],components:{Stats:l,Tabs:R},computed:{hasLog(){return!1!==this.$store.state.retour.meta.hasLog}},async created(){!1===this.canAccess&&this.$router.push("/"),await this.$store.dispatch("retour/init")}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"retour"},[t.hasLog?s("stats"):t._e(),t._v(" "),s("tabs")],1)}),[],!1,(function(t){for(let e in N)this[e]=N[e]}),null,null,null).exports;const F={};var H=s({extends:"k-text-field",methods:{open(){this.$refs.selector.open({endpoint:"retour/pagepicker",max:1,multiple:!1,selected:[],search:!0})},onSelect(t){this.$emit("input",t[0].id)}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-field",t._b({staticClass:"k-text-field",attrs:{input:t._uid,counter:t.counterOptions},scopedSlots:t._u([{key:"options",fn:function(){return[s("k-button",{staticClass:"k-field-options-button",attrs:{icon:"circle-nested"},on:{click:t.open}},[t._v("\n      "+t._s(t.$t("select"))+"\n    ")])]},proxy:!0}])},"k-field",t.$props,!1),[t._v(" "),s("k-input",t._g(t._b({ref:"input",attrs:{id:t._uid,type:"text",theme:"field"}},"k-input",t.$props,!1),t.$listeners)),t._v(" "),s("k-pages-dialog",{ref:"selector",on:{submit:t.onSelect}})],1)}),[],!1,(function(t){for(let e in F)this[e]=F[e]}),null,null,null).exports;const V={};var B=s({extends:"k-select-field",mixins:[x],methods:{onInput(t){this.value=t}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-field",t._b({staticClass:"k-select-field",attrs:{input:t._uid}},"k-field",t.$props,!1),[s("k-input",t._g(t._b({ref:"input",attrs:{id:t._uid,type:"select",theme:"field"},on:{input:t.onInput},scopedSlots:t._u([{key:"before",fn:function(){return[s("k-icon",{attrs:{type:"circle",color:t.color}})]},proxy:!0}])},"k-input",t.$props,!1),t.$listeners))],1)}),[],!1,(function(t){for(let e in V)this[e]=V[e]}),null,null,null).exports;panel.plugin("distantnative/retour",{views:{retour:{component:U,icon:"road-sign"}},fields:{"rt-status":B,"rt-destination":H},created(e){var s;e.$store.registerModule("retour",{namespaced:!0,state:{data:{redirects:[],fails:[],stats:[]},view:{from:(s=e).$library.dayjs().startOf("month"),to:s.$library.dayjs().endOf("month")},meta:{deleteAfter:null,hasLog:null,headers:[],first:null,last:null}},getters:{isAll:t=>{const e=s.$library.dayjs(t.meta.first),r=s.$library.dayjs(t.meta.last);return t.view.from.isSame(e,"day")&&t.view.to.isSame(r,"day")},hasPrev:(t,e)=>t.view.from.isAfter(s.$library.dayjs(t.meta.first),e.unit),hasNext:(t,e)=>t.view.to.isBefore(s.$library.dayjs(t.meta.last),e.unit),unit:e=>t(e.view)},mutations:{SET_DATA(t,e){s.$set(t,"data",e)},SET_META(t,e){s.$set(t,"meta",e)},SET_VIEW(t,e){s.$set(t,"view",e)}},actions:{init(t){t.dispatch("meta"),t.dispatch("data")},async meta(t){const e=await s.$api.get("retour/meta");t.commit("SET_META",e)},async data(e,r=e.state.view){const o={from:r.from.format("YYYY-MM-DD"),to:r.to.format("YYYY-MM-DD"),unit:t(r)},i=await s.$api.get("retour/data",o);e.commit("SET_DATA",i)},async view(t,e){e={from:s.$library.dayjs(e.from),to:s.$library.dayjs(e.to)},await t.dispatch("data",e),t.commit("SET_VIEW",e)}}})}});
